<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Swiper CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

  <!-- Boxicons -->
  <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

  <!-- Your Custom CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="preloader-wrapper">
    <div class="preloader"></div>
  </div> 

  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasModify"
    aria-labelledby="offcanvasModify">
    <div class="offcanvas-header justify-content-center">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div id="form-container">
        <h2>Consumer Form</h2>
        <form id="consumerForm">
          <input type="hidden" id="rowIndex" name="rowIndex">
          <div class="form-group">
            <label for="name">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
            <input type="text" class="form-control" id="name" name="name" required>
          </div>
          <div class="form-group">
            <label for="address">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
            <input type="text" class="form-control" id="address" name="address" required>
          </div>
          <div class="form-group">
            <label for="Mobile No">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
            <input type="text" class="form-control" id="mobileno" name="mobileno" required>
          </div>
          <div class="form-group">
            <label for="Age">Age</label>
            <input type="text" class="form-control" id="age" name="age" required>
          </div>
          <div class="form-group">
            <label for="gender">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
            <select class="form-control" id="gender" name="gender" required>
              <option value="Male">‡∏Ç‡∏≠‡∏á‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ (processed food)</option>
              <option value="Female">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå (meat)</option>
              <option value="Transgender">‡πÄ‡∏™‡πâ‡∏ô (overall noodle)</option>
              <option value="Others">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="image">Image</label>
            <input type="file" class="form-control-file" id="image" name="image" accept="image/*" required>
          </div>
          <div class="form-group">
            <div id="imagePreview"></div>
          </div>
          <button type="submit" class="btn btn-success" id="submitbutton">Submit</button>
          <button type="button" class="btn btn-secondary" id="cancelEdit" style="display: none;">Cancel</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î -->
  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasSearch"
    aria-labelledby="offcanvasSearchLabel">
    <div class="offcanvas-header justify-content-center">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <p id="location"><i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</i></p>
      <p id="distance"></p>
      <div id="map" style="height: 300px;"></div>

      <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
      <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
      <select id="paymentMethod">
        <option value="cash">üíµ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
        <option value="qr">üì≤ ‡∏™‡πÅ‡∏Å‡∏ô QR Code</option>
      </select>

      <button id="checkout-btn" onclick="checkout()" class="w-100 btn btn-primary btn-lg" disabled>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    </div>
  </div>


  <!-- ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasCart"
    aria-labelledby="offcanvasCartLabel">
    <div class="offcanvas-header justify-content-center">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <h4 id="cart-type-title" class="text-primary">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: -</h4>
      <!-- <h4 id="order-type-title" class="text-secondary">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: -</h4> -->
      <ul id="cart-list" class="list-group mb-3"></ul>
      <li id="cart-total-price" class="list-group-item d-flex justify-content-between">
        <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
        <strong>0 ‡∏ö‡∏≤‡∏ó</strong>
      </li>
      <li id="member-point" class="list-group-item d-flex justify-content-between"></li>
      <button id="nextButton" onclick="getLocation()" class="w-100 btn btn-primary btn-lg">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>
  </div>

  <!-- ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasNavbar"
    aria-labelledby="offcanvasNavbarLabel">
    <div class="offcanvas-header justify-content-center">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
      <div class="header">
        <h5>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h5>
      </div>


      <div class="mt-3">
        <h6>üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h6>
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong>
          <?= userData.name; ?>
        </p>
        <p><strong>‡πÇ‡∏ó‡∏£:</strong>
          <?= userData.telephone; ?>
        </p>
        <input type="text" class="form-control" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á">
      </div>

      <div class="mt-3">
        <h6>üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h6>
        <div id="cart-list"></div>
        <li id="cart-total-price" class="list-group-item d-flex justify-content-between">
          <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
          <strong>0 ‡∏ö‡∏≤‡∏ó</strong>
        </li>
      </div>

      <div class="mt-3">
        <h6>üöö ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h6>
        <div class="d-flex align-items-center">
          <div class="form-check me-3">
            <input class="form-check-input" type="radio" name="delivery" id="deliveryNow" checked onclick="toggleTimeInput(false)">
            <label class="form-check-label" for="deliveryNow">‡∏£‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</label>
          </div>
          <div class="form-check d-flex align-items-center">
            <input class="form-check-input me-1" type="radio" name="delivery" id="deliveryLater" onclick="toggleTimeInput(true)">
            <label class="form-check-label me-2" for="deliveryLater">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤</label>
            <input type="time" id="deliveryTime" class="form-control form-control-sm" style="display: none; width: 120px;">
          </div>
        </div>
      </div>


      <div class="mt-3">
        <h6>üîß ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h6>
        <div class="d-flex flex-wrap">
          <div class="form-check me-3">
            <input class="form-check-input" type="checkbox" id="noSpoon">
            <label class="form-check-label" for="noSpoon">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ä‡πâ‡∏≠‡∏ô</label>
          </div>
          <div class="form-check me-3">
            <input class="form-check-input" type="checkbox" id="noStraw">
            <label class="form-check-label" for="noStraw">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≠‡∏î</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="noBag">
            <label class="form-check-label" for="noBag">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ñ‡∏∏‡∏á</label>
          </div>
        </div>
      </div>


      <div class="mt-3">
        <h6>üí≥ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h6>

        <div class="btn-group-vertical w-100" role="group">
          <input type="radio" class="btn-check" name="paymentMethod" id="payNow" autocomplete="off" onclick="togglePaymentOption('now')">
          <label class="btn btn-outline-primary" for="payNow">üí≥ ‡∏™‡πÅ‡∏Å‡∏ô QR Code</label>

          <input type="radio" class="btn-check" name="paymentMethod" id="payLater" autocomplete="off" onclick="togglePaymentOption('later')">
          <label class="btn btn-outline-primary" for="payLater">üöö ‡∏ä‡∏≥‡∏£‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</label>
        </div>

        <div id="paymentOptions" class="mt-3" style="display: none;">
          <div id="qrCodeOption">
            <p>üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
            <img id="qrCodeImage" alt="QR Code" class="img-fluid" width="200">
          </div>
          <div id="cashOption" style="display: none;">
            <p>üí∞ ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ö Rider</p>
          </div>
        </div>
      </div>

      <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á PromptPay QR Code
        function generatePromptPayQR(phoneNumber, amount) {
          var url = "https://promptpay.io/" + phoneNumber + "/" + amount + ".png";
          return url;  // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á QR Code
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        function togglePaymentOption(method) {
          let paymentDiv = document.getElementById("paymentOptions");
          let qrCode = document.getElementById("qrCodeOption");
          let cash = document.getElementById("cashOption");

          // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          paymentDiv.style.display = "block";

          if (method === 'now') {
            let phoneNumber = "0636869497";  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô
            let amount = 100;  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
            let qrUrl = generatePromptPayQR(phoneNumber, amount);
            
            // ‡πÅ‡∏™‡∏î‡∏á QR Code
            qrCode.style.display = "block";
            qrCode.innerHTML = `<p>üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p><img src="${qrUrl}" alt="QR Code" class="img-fluid" width="200">`;

            cash.style.display = "none";
          } else {
            qrCode.style.display = "none";
            cash.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ö Rider"
          }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
        function toggleTimeInput(show) {
          document.getElementById("deliveryTime").style.display = show ? "block" : "none";
        }
      </script>
    </div>


  </div>
  <!-- User -->
  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasUser"
    aria-labelledby="offcanvasNavbarLabel">
    <div class="offcanvas-header justify-content-center">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="profile-card">
      <!-- Container ‡∏´‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö OTP -->
      <div class="profile-image-container">
        <!-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
        <img src="<?= userData.picture; ?>" alt="Profile Picture" class="profile-img">
        <!-- OTP ‡∏ß‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Absolute ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô -->
        <span id="otp-display" class="otp-badge">
          <?= userData.otp; ?>
        </span>
      </div>

      <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
      <h2 class="text-dark">
        <?= userData.name; ?>
      </h2>

      <!-- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
      <p class="text-dark" id="telephone-display">
        <span id="telephone-text"><?= userData.telephone; ?></span>
        <button class="btn btn-sm btn-primary" onclick="editTelephone()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </p>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
      <p class="text-dark" id="telephone-edit" style="display: none;">
        <input type="text" id="telephone-input" class="form-control d-inline-block w-auto" value="<?= userData.telephone; ?>">
        <button class="btn btn-sm btn-success" onclick="saveTelephone()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn btn-sm btn-danger" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </p>

      <!-- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -->
      <p class="text-dark">
        Member Point: <span class="highlight"><?= userData.point; ?></span> Point
      </p>

      <!-- UID -->
      <button class="btn btn-sm btn-primary" onclick="toggleUID()">
        UID:
        <p class="text-muted" id="uid-display" style="display: none;"><?= userData.uid; ?></p>
      </button>
    </div>

    <script>
      var userData = {
            uid: "<?= userData.uid; ?>",
            telephone: "<?= userData.telephone; ?>",
            otp: "<?= userData.otp; ?>"
        };

        function editTelephone() {
            document.getElementById("telephone-display").style.display = "none";
            document.getElementById("telephone-edit").style.display = "block";
        }

        function cancelEdit() {
            document.getElementById("telephone-display").style.display = "block";
            document.getElementById("telephone-edit").style.display = "none";
        }

        function saveTelephone() {
            var newTelephone = document.getElementById("telephone-input").value;

            google.script.run.withSuccessHandler(function(response) {
                if (response === 'success') {
                    document.getElementById("telephone-text").innerText = newTelephone;
                    userData.telephone = newTelephone;
                    cancelEdit();
                } else {
                    alert('Failed to save data. Please try again later.');
                }
            }).saveData({ id: userData.uid, telephone: newTelephone });
        }

        function toggleUID() {
            var uidElement = document.getElementById("uid-display");
            uidElement.style.display = uidElement.style.display === "none" ? "block" : "none";
        }


        google.script.run.withSuccessHandler(function(result) {
            if (result) {
                document.getElementById("otp-display").innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" style="fill: rgba(255, 196, 63, 1);">
                        <path d="M19.965 8.521C19.988 8.347 20 8.173 20 8c0-2.379-2.143-4.288-4.521-3.965C14.786 2.802 13.466 2 12 2s-2.786.802-3.479 2.035C6.138 3.712 4 5.621 4 8c0 .173.012.347.035.521C2.802 9.215 2 10.535 2 12s.802 2.785 2.035 3.479A3.976 3.976 0 0 0 4 16c0 2.379 2.138 4.283 4.521 3.965C9.214 21.198 10.534 22 12 22s2.786-.802 3.479-2.035C17.857 20.283 20 18.379 20 16c0-.173-.012-.347-.035-.521C21.198 14.785 22 13.465 22 12s-.802-2.785-2.035-3.479zm-9.01 7.895-3.667-3.714 1.424-1.404 2.257 2.286 4.327-4.294 1.408 1.42-5.749 5.706z"></path>
                    </svg>`;
            } else {
                document.getElementById("otp-display").innerText = "OTP ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
            }
        }).verifyOTPAndClear(userData.uid, userData.otp);

    </script>
  </div>

  <header>
    <div class="container-fluid">
      <div class="row py-3 border-bottom">
        <div class="col-sm-4 col-lg-3 text-center text-sm-start">
          <div class="main-logo">
            <a>
              <img src="https://img5.pic.in.th/file/secure-sv1/b355aac94056dfc55e4d7a2a0034b55b.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" border="0">
            </a>
          </div>
        </div>
        <div class="col-sm-6 offset-sm-2 offset-md-0 col-lg-5 d-none d-lg-block"></div>
        <div class="d-flex justify-content-end list-unstyled m-0">
          <li>
            <a class="rounded-circle bg-light p-2 mx-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-award"
                viewBox="0 0 16 16">
                <path
                  d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68zm1.196 1.193.684 1.365 1.086 1.072L12.387 6l.248 1.506-1.086 1.072-.684 1.365-1.51.229L8 10.874l-1.355-.702-1.51-.229-.684-1.365-1.086-1.072L3.614 6l-.25-1.506 1.087-1.072.684-1.365 1.51-.229L8 1.126l1.356.702z" />
                <path d="M4 11.794V16l4-1 4 1v-4.206l-2.018.306L8 13.126 6.018 12.1z" />
              </svg>
            </a>
          </li>
          <ul class="d-flex justify-content-end list-unstyled m-0">
            <li>
              <a class="rounded-circle bg-light p-2 mx-1" data-bs-toggle="offcanvas" data-bs-target="#offcanvasUser"
                aria-controls="offcanvasUser">
                <img src="<?= userData.picture; ?>" width="30" height="30" style="border-radius: 50%;">
              </a>
            </li>
            <li>
              <a class="rounded-circle bg-light p-2 mx-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-heart"
                  viewBox="0 0 16 16">
                  <path
                    d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15" />
                </svg>
              </a>
            </li>
            <li>
              <a class="rounded-circle bg-light p-2 mx-1" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart"
                aria-controls="offcanvasCart">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-basket"
                  viewBox="0 0 16 16">
                  <path
                    d="M5.757 1.071a.5.5 0 0 1 .172.686L3.383 6h9.234L10.07 1.757a.5.5 0 1 1 .858-.514L13.783 6H15a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1v4.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 13.5V9a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1.217L5.07 1.243a.5.5 0 0 1 .686-.172zM2 9v4.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V9zM1 7v1h14V7zm3 3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 4 10m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 6 10m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5" />
                </svg>
              </a>
            </li>
            <div class="cart text-end d-none d-lg-block dropdown">
              <button class="border-0 bg-transparent d-flex flex-column gap-2 lh-1" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart" aria-controls="offcanvasCart">

                <span class="cart-total fs-5 fw-bold"></span>
              </button>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                <span class="navbar-toggler-icon"></span>
              </button>
          </ul>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="category-carousel swiper">
            <div class="swiper-wrapper">

              <a id="btn-delivery" class="btn-pickup category-item swiper-slide" onclick="selectOrderType('‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ')">
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 24 24"
                  style="fill: rgba(0, 0, 0, 1);">
                  <circle cx="18" cy="4" r="2"></circle>
                  <path
                    d="m17.836 12.014-4.345.725 3.29-4.113a1 1 0 0 0-.227-1.457l-6-4a.999.999 0 0 0-1.262.125l-4 4 1.414 1.414 3.42-3.42 2.584 1.723-2.681 3.352a5.913 5.913 0 0 0-5.5.752l1.451 1.451A3.972 3.972 0 0 1 8 12c2.206 0 4 1.794 4 4 0 .739-.216 1.425-.566 2.02l1.451 1.451A5.961 5.961 0 0 0 14 16c0-.445-.053-.878-.145-1.295L17 14.181V20h2v-7a.998.998 0 0 0-1.164-.986zM8 20c-2.206 0-4-1.794-4-4 0-.739.216-1.425.566-2.02l-1.451-1.451A5.961 5.961 0 0 0 2 16c0 3.309 2.691 6 6 6 1.294 0 2.49-.416 3.471-1.115l-1.451-1.451A3.972 3.972 0 0 1 8 20z">
                  </path>
                </svg>
                <h3 class="category-title">‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</h3>
              </a>

              <a id="btn-pickup" class="btn-delivery category-item swiper-slide"
                onclick="selectOrderType('‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô')">
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 24 24"
                  style="fill: rgba(0, 0, 0, 1);">
                  <path
                    d="M22 5c0-1.654-1.346-3-3-3H5C3.346 2 2 3.346 2 5v2.831c0 1.053.382 2.01 1 2.746V19c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-8.424c.618-.735 1-1.692 1-2.746V5zm-2 0v2.831c0 1.14-.849 2.112-1.891 2.167L18 10c-1.103 0-2-.897-2-2V4h3c.552 0 1 .449 1 1zM10 4h4v4c0 1.103-.897 2-2 2s-2-.897-2-2V4zM4 5c0-.551.448-1 1-1h3v4c0 1.103-.897 2-2 2l-.109-.003C4.849 9.943 4 8.971 4 7.831V5zm6 14v-3h4v3h-4zm6 0v-3c0-1.103-.897-2-2-2h-4c-1.103 0-2 .897-2 2v3H5v-7.131c.254.067.517.111.787.125A3.988 3.988 0 0 0 9 10.643c.733.832 1.807 1.357 3 1.357s2.267-.525 3-1.357a3.988 3.988 0 0 0 3.213 1.351c.271-.014.533-.058.787-.125V19h-3z">
                  </path>
                </svg>
                <h3 class="category-title">‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô</h3>
              </a>

            </div>
          </div>
          <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
          <div class="container my-4" id="product-type-container">
            <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <button id="btn-piking-tasoss" class="btn btn-outline-primary" onclick="selectProductType('‡∏õ‡∏¥‡πâ‡∏á‡∏ó‡∏≤‡∏ã‡∏≠‡∏™‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤')">‡∏õ‡∏¥‡πâ‡∏á‡∏ó‡∏≤‡∏ã‡∏≠‡∏™‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤</button>
            <button id="btn-samros" class="btn btn-outline-primary" onclick="selectProductType('‡∏¢‡∏≥‡∏™‡∏≤‡∏°‡∏£‡∏™')">‡∏¢‡∏≥‡∏™‡∏≤‡∏°‡∏£‡∏™</button>
            <button id="btn-shabu" class="btn btn-outline-primary" onclick="selectProductType('‡∏ä‡∏≤‡∏ö‡∏π')">‡∏ä‡∏≤‡∏ö‡∏π</button>
          </div>

          <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≤‡∏ö‡∏π -->
          <div class="container my-4" id="shabu-options" style="display:none;">
            <button class="btn btn-outline-primary" onclick="selectShabuType('‡∏ô‡πâ‡∏≥‡∏î‡∏≥')">‡∏ô‡πâ‡∏≥‡∏î‡∏≥</button>
            <button class="btn btn-outline-primary" onclick="selectShabuType('‡∏ô‡πâ‡∏≥‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤')">‡∏ô‡πâ‡∏≥‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
  <section class="py-5">
    <div class="container-fluid" id="list">
      <div class="row">
        <div class="col-md-12">
          <div class="bootstrap-tabs product-tabs">
            <div class="tabs-header d-flex justify-content-between border-bottom my-5">
              <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            </div>
            <div class="tab-content" id="nav-tabContent">
              <div class="tab-pane fade show active" id="nav-all" role="tabpanel">
                <div id="product-list"
                  class="product-grid row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let map, userMarker, startMarker;
      let userLat = null, userLon = null;
      let startLat = 16.5554488, startLon = 99.7297617;

      let products = [];
      let cart = {};
      let orderType = "";
      let selectedProductType = "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
      let productType = "";      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏õ‡∏¥‡πâ‡∏á‡∏ó‡∏≤‡∏ã‡∏≠‡∏™‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤, ‡∏¢‡∏≥‡∏™‡∏≤‡∏°‡∏£‡∏™, ‡∏ä‡∏≤‡∏ö‡∏π)
      let currentShabuType = ""; // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ (‡∏ô‡πâ‡∏≥‡∏î‡∏≥, ‡∏ô‡πâ‡∏≥‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤)
      var userData = {
        uid: "<?= userData.uid; ?>",
        telephone: "<?= userData.telephone; ?>"
      };
      const checkoutBtn = document.getElementById("checkout-btn");

      document.getElementById("nextButton").addEventListener("click", function () {
        let cartOffcanvas = bootstrap.Offcanvas.getInstance(document.getElementById("offcanvasCart"));
        cartOffcanvas.hide();
        setTimeout(() => {
          new bootstrap.Offcanvas(document.getElementById("offcanvasSearch")).show();
        }, 300);
      });

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(position => {
            userLat = position.coords.latitude;
            userLon = position.coords.longitude;

            document.getElementById("location").innerHTML = `<b>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</b> ${userLat.toFixed(6)}, ${userLon.toFixed(6)}`;
            document.getElementById("distance").innerHTML = `<b>üöó ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô:</b> ${calculateDistance(startLat, startLon, userLat, userLon).toFixed(2)} ‡∏Å‡∏°.`;

            checkoutBtn.disabled = false;
            showMap(userLat, userLon);
          }, error => {
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ: " + error.message);
          });
        } else {
          alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á");
        }
      }

      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371, dLat = toRad(lat2 - lat1), dLon = toRad(lon2 - lon1);
        const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
        return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
      }

      const toRad = degrees => degrees * (Math.PI / 180);

      function showMap(lat, lon) {
        if (!map) {
          map = L.map('map').setView([lat, lon], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
          startMarker = L.marker([startLat, startLon]).addTo(map).bindPopup("üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô").openPopup();
        }
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([lat, lon]).addTo(map).bindPopup("üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì").openPopup();
        map.setView([lat, lon], 13);
      }

      function fetchProducts() {
        google.script.run.withSuccessHandler(renderProducts).getProducts();
      }

      ///‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤///
      function renderProducts(data) {
        products = data;
        let productList = document.getElementById("product-list");
        productList.innerHTML = data.map((product, index) => {
            let cartQty = cart[index] ? cart[index].quantity : 0; // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            let remainingStock = product.stock - cartQty; // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á

            return `
            <div class="product-item">
              <a class="btn-wishlist" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModify">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                </svg>
              </a>
              <figure>
                <a><img src="${product.image}" class="tab-image" alt="${product.name}"></a>
              </figure>
              <h3>${product.name}</h3>
              <span class="qty">‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="stock-${index}">${remainingStock}</span> ‡∏ä‡∏¥‡πâ‡∏ô</span>
              <span class="price">‡∏£‡∏≤‡∏Ñ‡∏≤: ${product.price} ‡∏ö‡∏≤‡∏ó</span>
              <div class="d-flex align-items-center justify-content-between">
                <div class="input-group product-qty">
                  <button class="btn btn-danger" onclick="updateCart(${index}, -1)">-</button>
                  <input type="text" class="form-control text-center" id="qty-${index}" value="${cartQty}" readonly>
                  <button class="btn btn-success" onclick="updateCart(${index}, 1)">+</button>
                </div>
              </div>
            </div>
            `;
        }).join("");

        renderCart();  
      }

      function updateCart(index, change) {
        if (!products[index]) {
            console.error(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ index ${index} ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
            return;
        }

        let product = products[index];
        if (!cart[index]) {
            cart[index] = { name: product.name, quantity: 0, price: product.price };
        }

        let newQty = (cart[index].quantity || 0) + change;
        
        if (newQty > 0 && newQty <= product.stock) {
            cart[index].quantity = newQty;
        } else if (newQty <= 0) {
            delete cart[index]; // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        }

        renderCart();

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        if (document.getElementById(`qty-${index}`)) {
            document.getElementById(`qty-${index}`).value = cart[index] ? cart[index].quantity : 0;
        }

        if (document.getElementById(`stock-${index}`)) {
            let remainingStock = product.stock - (cart[index] ? cart[index].quantity : 0);
            document.getElementById(`stock-${index}`).innerText = remainingStock;
        }
      }

      function renderCart() {
        let cartList = document.getElementById("cart-list");
        cartList.innerHTML = Object.entries(cart)
            .map(([index, item]) => `
            <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                    <h6>${item.name}</h6><small>${item.quantity * item.price} ‡∏ö‡∏≤‡∏ó</small>
                </div>
                <span class="d-flex align-items-center">
                    <button class="btn btn-danger" onclick="updateCart(${index}, -1)">-</button>
                    <span class="mx-2" id="quantity-${index}">${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    <button class="btn btn-success" onclick="updateCart(${index}, 1)">+</button>
                    <button type="button" class="btn-close" onclick="removeFromCart(${index})"></button>
                </span>
            </li>`).join("");

        let totalPrice = Object.values(cart).reduce((sum, item) => sum + item.quantity * item.price, 0);
        document.getElementById("total-price").innerText = ` ${totalPrice} ‡∏ö‡∏≤‡∏ó`;
        document.getElementById("cart-total-price").innerHTML = `<span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span> <strong>${totalPrice} ‡∏ö‡∏≤‡∏ó</strong>`;
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö totalPrice
        document.getElementById("member-point").innerHTML = `<span>member-point:</span> <strong>${totalPrice} point</strong>`;
      }


      function removeFromCart(index) {
          delete cart[index];
          renderCart();
          if (document.getElementById(`qty-${index}`)) {
              document.getElementById(`qty-${index}`).value = 0;
          }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      function setProductType(type) {
          selectedProductType = type; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          updateCartTitle(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      function updateCartTitle() {
        const cartTitle = document.getElementById("cart-type-title");
          if (cartTitle) {
              cartTitle.innerText = `‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${productType}`;
          }
      }

      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      document.addEventListener("DOMContentLoaded", function() {
          setProductType("‡∏≠‡∏≤‡∏´‡∏≤‡∏£"); // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "‡∏≠‡∏≤‡∏´‡∏≤‡∏£"
      });

      ///‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤///
      function checkout() { 
        if (!userData || !userData.uid) {
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà");
            return;
        }

        let orderItems = Object.values(cart).filter(item => item.quantity > 0);
        if (orderItems.length === 0) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠!");
            return;
        }
        if (!orderType) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠!");
            return;
        }
        if (!userLat || !userLon) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
            return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        let paymentMethod = document.getElementById('paymentMethod').value;
        if (!paymentMethod) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô!");
            return;
        }

        let totalPrice = 0;
        orderItems.forEach(item => {
            totalPrice += item.quantity * item.price;
        });

        let point = totalPrice; // ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°

        let checkoutBtn = document.getElementById('checkout-btn');
        checkoutBtn.disabled = true;
        checkoutBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        let fullOrderData = {
            type: orderType,
            productType: productType,
            shabuType: currentShabuType,
            items: orderItems,
            paymentMethod: paymentMethod,
            point: point
        };

        let userOrderData = { 
            uid: userData.uid,
            lat: userLat, 
            lon: userLon,
            paymentMethod: paymentMethod,
            totalPrice: totalPrice
        };

        google.script.run.withSuccessHandler(() => {
            alert(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ${paymentMethod}`);
            cart = {};
            renderCart();
            fetchProducts();
            checkoutBtn.disabled = false;
            checkoutBtn.innerText = "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠";
        }).saveOrderAndUserClick(userOrderData, fullOrderData);
    }


      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
      // ‡∏ã‡πà‡∏≠‡∏ô container ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô CSS ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô)
      document.getElementById("list").style.display = "block";

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      function checkAndShowProducts() {
        if (orderType && productType) {
          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß
          document.getElementById("list").style.display = "block"; // none / flex ‡∏´‡∏£‡∏∑‡∏≠ block ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 
          fetchProducts();
        }
      }

      // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
      function selectOrderType(type) {
        orderType = type;
        console.log("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ", orderType);

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏•‡∏≤‡∏™‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        document.getElementById("btn-delivery").classList.toggle("btn-active", type === "‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ");
        document.getElementById("btn-pickup").classList.toggle("btn-active", type === "‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô");

        // (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        checkAndShowProducts();
      }

      // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      function selectProductType(type) {
        productType = type;
        console.log("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ", productType);

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        updateCartTitle();

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        document.getElementById("btn-piking-tasoss").classList.remove("btn-active");
        document.getElementById("btn-samros").classList.remove("btn-active");
        document.getElementById("btn-shabu").classList.remove("btn-active");

        if (type === '‡∏õ‡∏¥‡πâ‡∏á‡∏ó‡∏≤‡∏ã‡∏≠‡∏™‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤') {
            document.getElementById("btn-piking-tasoss").classList.add("btn-active");
            toggleShabuOptions(false);
        } else if (type === '‡∏¢‡∏≥‡∏™‡∏≤‡∏°‡∏£‡∏™') {
            document.getElementById("btn-samros").classList.add("btn-active");
            toggleShabuOptions(false);
        } else if (type === '‡∏ä‡∏≤‡∏ö‡∏π') {
            document.getElementById("btn-shabu").classList.add("btn-active");
            toggleShabuOptions(true);
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        checkAndShowProducts();
      }


      function selectShabuType(type) {
          if (currentShabuType === type) {
              currentShabuType = "";
              console.log("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ");
          } else {
              currentShabuType = type;
              console.log("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ: " + currentShabuType);
          }
          updateShabuButtons();
          updateCartTitle();
      }

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ
      function updateShabuButtons() {
          const buttons = document.querySelectorAll('#shabu-options button');
          buttons.forEach(button => {
              button.classList.toggle('btn-active', button.innerText === currentShabuType);
          });
      }

      // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≤‡∏ö‡∏π
      function toggleShabuOptions(show) {
          let shabuOptions = document.getElementById("shabu-options");
          shabuOptions.style.display = show ? "block" : "none";
          if (!show) {
              currentShabuType = "";
              updateShabuButtons();
          }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      function updateCartTitle() {
        let cartTitle = document.getElementById("cart-type-title");
        if (cartTitle) {
            let displayText = productType;
            if (productType === "‡∏ä‡∏≤‡∏ö‡∏π" && currentShabuType) {
                displayText += ` (${currentShabuType})`;
            }
            cartTitle.innerText = `‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${displayText || '-'}`;
        }
    }

      window.onload = fetchProducts;
    </script>
  </section>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ -->
  <div class="fixed-bottom-bar">
    <button class="cart-btn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart">
      ‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span id="total-price"><strong>0 ‡∏ö‡∏≤‡∏ó</strong></span>
    </button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
  </script>
  <?!= HtmlService.createHtmlOutputFromFile('plugins').getContent() ?>
  <?!= HtmlService.createHtmlOutputFromFile('script').getContent() ?>
  <script src="script.js"></script>
</body>

</html>
